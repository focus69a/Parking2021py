{% extends "parking_template.html" %}
{% block head %}
<meta charset="utf-8" />
<meta name="description" content="Opis strony" />
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename= 'parking-mapa.css')}}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin="">
</script>
{% endblock %}

{% block title %} Parking_select {% endblock %}

{% block content %} 
<div class="screenSize">

  <!-- <header>
    <h1> Parking Premium Availability </h1>
  </header> -->
  <div id="mapDiv"> </div>
  <!--
<div id="mapDiv" style="width: 400px; height: 250px"></div>
  -->

  <script>
//ikona dla markera celu
// var myIcon = L.icon({
//     iconUrl: 'RedDot.svg',
//     iconSize: [38, 95],
//     iconAnchor: [22, 94],
//     popupAnchor: [-3, -76],
//     shadowUrl: 'RedDot.svg',
//     shadowSize: [68, 95],
//     shadowAnchor: [22, 94]
// });

var myIcon = L.icon({
    iconUrl: '/static/target10.svg',
    iconSize: [30, 30]
});

var IconBusy = L.icon({
    iconUrl: '/static/IconBusy.svg',
    iconSize: [30, 30]
});

var IconFree = L.icon({
    iconUrl: '/static/IconFree.svg',
    iconSize: [20, 30]
});

  // position we will use later
  //var lat1 = 52.220061;
  //var lon1 = 21.012097;
  //var lat2 = 52.220161;
  //var lon2 = 21.012197;
  //var lat3 = 52.220261;
  //var lon3 = 21.012297;
  
  var lat = {{lat}}
  var lon = {{lon}}
  var radius1 = {{radius1}}
  var radius2 = {{radius2}}
  var radius3 = {{radius3}}
  var lsf = JSON.parse({{lsf|tojson}})
  var lsb = JSON.parse({{lsb|tojson}})
  var lmf = JSON.parse({{lmf|tojson}})
  var lmb = JSON.parse({{lmb|tojson}})
  var llf = JSON.parse({{llf|tojson}})
  var llb = JSON.parse({{llb|tojson}})
  var lsf_len = lsf.length
  var lsb_len = lsb.length
  var lmf_len = lmf.length
  var lmb_len = lmb.length
  var llf_len = llf.length
  var llb_len = llb.length

  console.log(lmf)
  console.log(lmf_len)
  
  // initialize map
//  map = L.map('mapDiv').setView([lat1, lon2], 17);
  map = L.map('mapDiv').setView([lat, lon], 17);
  
  map.flyTo([lat, lon], 17)

  // set map tiles source
  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
  maxZoom: 18,
  }).addTo(map);
  // add marker to the map
  marker_my_pos = L.marker([lat, lon],{icon: myIcon}).addTo(map);
  
  //================================================
  for(i=0; i < lsf_len; i++)
{
  marker = L.marker([lsf[i]['lat'] , lsf[i]['lon'] ],{icon: IconFree}).addTo(map);
  marker.bindPopup(lsf[i]['opis']).openPopup();
  console.log("lp lsf:" + lsf[i]['lat'] + lsf[i]['lon']);
}
for(i=0; i < lsb_len; i++)
{
  marker = L.marker([lsb[i]['lat'] , lsb[i]['lon'] ],{icon: IconBusy}).addTo(map);
  console.log("lp lsb:" + lsb[i]['lat'] + lsb[i]['lon']);
}
for(i=0; i < lmf_len; i++)
{
  marker = L.marker([lmf[i]['lat'] , lmf[i]['lon'] ],{icon: IconFree}).addTo(map);
  marker.bindPopup(lmf[i]['opis']).openPopup();
  console.log("lp mlf:" + lmf[i]['lat'] + lmf[i]['lon']);
}
for(i=0; i < lmb_len; i++)
{
  marker = L.marker([lmb[i]['lat'] , lmb[i]['lon'] ],{icon: IconBusy}).addTo(map);
  console.log("lp lmb:" + lmb[i]['lat'] + lmb[i]['lon']);
}
for(i=0; i < llf_len; i++)
{
  marker = L.marker([llf[i]['lat'] , llf[i]['lon'] ],{icon: IconFree}).addTo(map);
  marker.bindPopup(llf[i]['opis']).openPopup();
  console.log("lp llf:" + llf[i]['lat'] + llf[i]['lon']);
}

for(i=0; i < llb_len; i++)
{
  marker = L.marker([llb[i]['lat'] , llb[i]['lon'] ],{icon: IconBusy}).addTo(map);
  console.log("lp llb:" + llb[i]['lat'] + llb[i]['lon']);
}
//====================================================

  //marker1 = L.marker([lat1, lon1],{icon: IconFree}).addTo(map);
  //marker2 = L.marker([lat2, lon2],{icon: IconBusy}).addTo(map);
  //marker3 = L.marker([lat3, lon3],{icon: IconBusy}).addTo(map);

  var circle100 = L.circle([lat, lon], {
    color: "red",
    fillColor: "#f03",
    fillOpacity: 0.05,
    radius: radius1
  }).addTo(map);
  var circle300 = L.circle([lat, lon], {
    color: "red",
    fillColor: "#f03",
    fillOpacity: 0.05,
    radius: radius2
  }).addTo(map);
  var circle500 = L.circle([lat, lon], {
    color: "red",
    fillColor: "#f03",
    fillOpacity: 0.05,
    radius: radius3
  }).addTo(map);
  // add popup to the marker
  
  //marker1.bindPopup("<b>ul. Nowowiejska 8</b><br /> 50m <br /> nr 2421 <br> przy bramie wjazdowej").openPopup();
  //marker2.bindPopup("<b>ul. Lwowska 1a</b><br /> 120m <br /> nr 5412 <br> za przystankiem").openPopup();
  //marker3.bindPopup("<b>ul. Nowowiejska 6a</b><br /> 350m <br /> nr 3534 <br> vis a vis Zabki").openPopup();
  marker_my_pos.bindPopup("<b> Your Destination ").openPopup();
  

  </script>

  <div class="selekcja">
    <span>
    <button id="ButtonShortDistnce" type="submit"> {{radius1}}m <br> len(lsf) available <br> Wait? </button> 
    <button id="ButtonMediumDistnce" type="submit"> {{radius2}}m <br> len(lmf)available <br> Take one? </button>
    <button id="ButtonLongDistance" type="submit"> {{radius3}}m <br> len(llf) available <br> Take one? </button>
    </span>	
  </div>
  <br>
  <div class="sterowanie">
    <span>
    <button id="SubmitButton" type="submit"> Refresh </button> 
    <button id="CancelButton" type="submit"> Cancel & Exit </button>
    </span>	
  </div>

    <!--
    
    <button type="button"
    onclick="document.getElementById('100mButton').innerHTML = Date()">
    100m <br> not available <br> Wait? </button>
    
    <button type="button"
    onclick="document.getElementById('300mButton').innerHTML = Date()">
    300m <br> 2 available <br> Take one? </button>
    <p id="300mButton"></p>
    <button type="button"
    onclick="document.getElementById('500mButton').innerHTML = Date()">
    500m <br> 6 available <br> Take one? </button>
    <p id="500mButton"></p>

    <button type="button"
    onclick="document.getElementById('RefreshButton').innerHTML = Date()">
    Refresh</button>
    <p id="RefreshButton"></p>
    
    <button type="button"
    onclick="document.getElementById('ExitButton').innerHTML = Date()">
    Exit</button>
    <p id="ExitButton"></p>
    -->
    </div>
  </div>

<!-- <div class="panel panel-default">
  <div class="panel-body">
    <p> Wybrane {{p1}} </p>
  </div>
</div>

<form action="" method="post">

  <p> To jest Display tego co zarezerwowane</p>
 
    <button type="submit" class="btn btn-secondary btn-lg" name="action" value="Refresh">Refresh & Wait</button>
    <button type="submit" class="btn btn-success btn-lg"   name="action" value="Reseve">Reserve It</button>
    <button type="submit" class="btn btn-secondary btn-lg"   name="action" value="Return">Cancel & Return</button>

  </form> -->
{% endblock %}
